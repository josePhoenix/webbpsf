from __future__ import division, print_function, absolute_import, unicode_literals
# This file contains constants and data that do not fit in the data
# package for one reason or another. It could be that they are in a
# data structure that doesn't serialize well or they're too small to
# make a separate file.

# It's hard to make anything truly immutable in Python, but here
# tuples are preferred and numpy arrays should have
# flags.writeable = False

import numpy as np
from matplotlib.path import Path
import astropy.units as u

__all__ = (
    'JWST_PRIMARY_SEGMENTS',
    'JWST_PRIMARY_STRUTS',
    'JWST_PRIMARY_SEGMENT_CENTERS',
    'JWST_SEGMENT_RADIUS',
    'JWST_CIRCUMSCRIBED_DIAMETER',
)

#
# JWST Primary segment and obscuration shapes and centers
#
# Provenance:
#
# Segment coordinates from "2010.03.16 Transmission X Area Budget.xls"
# spreadsheet by Paul Lightsey, which was based in turn on
# Ball Aerospace drawing # 2220169 Rev B and the OTE Cryogenic Optics
# Interface Control Document, Ball Aerospace doc # C327693

JWST_PRIMARY_SEGMENTS = (
    ('A1-1', np.array([
        [-0.38101, 0.667604],
        [-0.758826, 1.321999],
        [-0.38101, 1.976407],
        [0.38101, 1.976407],
        [0.758826, 1.321999],
        [0.38101, 0.667604]])),
    ('A2-2', np.array([
        [0.38765702, 0.66376634],
        [0.76547172, 1.31816209],
        [1.52111367, 1.31816784],
        [1.90212367, 0.65823916],
        [1.52429772, 0.00383691],
        [0.76866702, 0.00383766]])),
    ('A3-3', np.array([
        [0.76866702, -0.00383766],
        [1.52429772, -0.00383691],
        [1.90212367, -0.65823916],
        [1.52111367, -1.31816784],
        [0.76547172, -1.31816209],
        [0.38765702, -0.66376634]])),
    ('A4-4', np.array([
        [0.38101, -0.667604],
        [0.758826, -1.321999],
        [0.38101, -1.976407],
        [-0.38101, -1.976407],
        [-0.758826, -1.321999],
        [-0.38101, -0.667604]])),
    ('A5-5', np.array([
        [-0.38765702, -0.66376634],
        [-0.76547172, -1.31816209],
        [-1.52111367, -1.31816784],
        [-1.90212367, -0.65823916],
        [-1.52429772, -0.00383691],
        [-0.76866702, -0.00383766]])),
    ('A6-6', np.array([
        [-0.76866702, 0.00383766],
        [-1.52429772, 0.00383691],
        [-1.90212367, 0.65823916],
        [-1.52111367, 1.31816784],
        [-0.76547172, 1.31816209],
        [-0.38765702, 0.66376634]])),
    ('B1-7', np.array([
        [0.38101, 3.279674],
        [0.758826, 2.631791],
        [0.38101, 1.98402],
        [-0.38101, 1.98402],
        [-0.758826, 2.631791],
        [-0.38101, 3.279674]])),
    ('B2-9', np.array([
        [3.030786, 1.30987266],
        [2.65861086, 0.65873291],
        [1.90871672, 0.66204566],
        [1.52770672, 1.32197434],
        [1.89978486, 1.97305809],
        [2.649776, 1.96980134]])),
    ('B3-11', np.array([
        [2.649776, -1.96980134],
        [1.89978486, -1.97305809],
        [1.52770672, -1.32197434],
        [1.90871672, -0.66204566],
        [2.65861086, -0.65873291],
        [3.030786, -1.30987266]])),
    ('B4-13', np.array([
        [-0.38101, -3.279674],
        [-0.758826, -2.631791],
        [-0.38101, -1.98402],
        [0.38101, -1.98402],
        [0.758826, -2.631791],
        [0.38101, -3.279674]])),
    ('B5-15', np.array([
        [-3.030786, -1.30987266],
        [-2.65861086, -0.65873291],
        [-1.90871672, -0.66204566],
        [-1.52770672, -1.32197434],
        [-1.89978486, -1.97305809],
        [-2.649776, -1.96980134]])),
    ('B6-17', np.array([
        [-2.649776, 1.96980134],
        [-1.89978486, 1.97305809],
        [-1.52770672, 1.32197434],
        [-1.90871672, 0.66204566],
        [-2.65861086, 0.65873291],
        [-3.030786, 1.30987266]])),
    ('C1-8', np.array([
        [0.765201, 2.627516],
        [1.517956, 2.629178],
        [1.892896, 1.976441],
        [1.521076, 1.325812],
        [0.765454, 1.325807],
        [0.387649, 1.980196]])),
    ('C2-10', np.array([
        [2.6580961, 0.651074495],
        [3.03591294, 5.42172989e-07],
        [2.65809612, -0.651075523],
        [1.90872487, -0.654384457],
        [1.53090954, 8.90571587e-07],
        [1.90872454, .654384118]])),
    ('C3-12', np.array([
        [1.8928951, -1.97644151],
        [1.51795694, -2.62917746],
        [0.76520012, -2.62751652],
        [0.38764887, -1.98019646],
        [0.76545554, -1.32580611],
        [1.52107554, -1.32581188]])),
    ('C4-14', np.array([
        [-0.765201, -2.627516],
        [-1.517956, -2.629178],
        [-1.892896, -1.976441],
        [-1.521076, -1.325812],
        [-0.765454, -1.325807],
        [-0.387649, -1.980196]])),
    ('C5-16', np.array([
        [-2.6580961, -.651074495],
        [-3.03591294, -5.42172990e-07],
        [-2.65809612, .651075523],
        [-1.90872487, .654384457],
        [-1.53090954, -8.90571587e-07],
        [-1.90872454, -.654384118]])),
    ('C6-18', np.array([
        [-1.8928951, 1.97644151],
        [-1.51795694, 2.62917746],
        [-0.76520012, 2.62751652],
        [-0.38764887, 1.98019646],
        [-0.76545554, 1.32580611],
        [-1.52107554, 1.32581188]])),
)

for name, arr in JWST_PRIMARY_SEGMENTS:
    arr.flags.writeable = False

JWST_PRIMARY_STRUTS = (
    ("strut1", np.array([
        [-0.05301375, -0.0306075],
        [1.59698625, -2.88849133],
        [1.70301375, -2.82727633],
        [0.05301375, 0.0306075],
        [-0.05301375, -0.0306075]])),
    ("strut2", np.array([
        [-0.05301375, 0.0306075],
        [-1.70301375, -2.82727633],
        [-1.59698625, -2.88849133],
        [0.05301375, -0.0306075],
        [-0.05301375, 0.0306075]])),
    ("strut3", np.array([
        [5.94350000e-02, -1.45573765e-17],
        [5.94350000e-02, 3.30000000e+00],
        [-5.94350000e-02, 3.30000000e+00],
        [-5.94350000e-02, 1.45573765e-17],
        [5.94350000e-02, -1.45573765e-17]])),
    ("strut3_bumps", np.array([
        [0.059435, 0.666],
        [0.059435, 2.14627],
        [0.082595, 2.14627],
        [0.082595, 2.3645],
        [0.059435, 2.3645],
        [0.059435, 2.48335],
        [0.069795, 2.48335],
        [0.069795, 2.54445],
        [0.059435, 2.54445],
        [0.059435, 3.279674],
        [-0.059435, 3.279674],
        [-0.059435, 2.54445],
        [-0.069795, 2.54445],
        [-0.069795, 2.48335],
        [-0.059435, 2.48335],
        [-0.059435, 2.3645],
        [-0.082595, 2.3645],
        [-0.082595, 2.14627],
        [-0.059435, 2.14627],
        [-0.059435, 0.666]]))
)

for name, arr in JWST_PRIMARY_STRUTS:
    arr.flags.writeable = False

JWST_PRIMARY_SEGMENT_CENTERS = (
    ('A1-1', (0.000000, 1.323500)),
    ('A2-2', (1.146185, 0.661750)),
    ('A3-3', (1.146185, -0.661750)),
    ('A4-4', (0.000000, -1.323500)),
    ('A5-5', (-1.146185, -0.661750)),
    ('A6-6', (-1.146185, 0.661750)),
    ('B1-7', (0.000000, 2.634719)),
    ('B2-9', (2.281734, 1.317360)),
    ('B3-11', (2.281734, -1.317359)),
    ('B4-13', (0.000000, -2.634719)),
    ('B5-15', (-2.281734, -1.317360)),
    ('B6-17', (-2.281734, 1.317360)),
    ('C1-8', (1.142963, 1.979670)),
    ('C2-10', (2.285926, 0.000000)),
    ('C3-12', (1.142963, -1.979670)),
    ('C4-14', (-1.142963, -1.979670)),
    ('C5-16', (-2.285926, -0.000000)),
    ('C6-18', (-1.142963, 1.979670))
)

JWST_SEGMENT_RADIUS = 1.517 / 2
JWST_CIRCUMSCRIBED_DIAMETER = 6.603464  # meters

#
# NIRISS GR700XD grism mask shape
#
# Provenance:
#
# COM DEV drawing #206726
# "GR700 (ZNSE) MASK RETAINER, ROTATED 270 DEG LLNL"
# provided by Loic Albert (UdeM) 2016-11-04
# vector path extracted from PDF and converted to SVG / matplotlib by Joseph Long (STScI)
# (see "Convert GR700XD SVG Path to Matplotlib Path.ipynb" in webbpsf-data-source)

NIRISS_GR700XD_MASK_VERTS = np.array([
    [27.54, 38.23],
    [31.43, 33.47],
    [33.32, 32.78],
    [35.09, 31.93],
    [35.09, 31.93],
    [35.30703524, 31.83691315],
    [35.52293902, 31.74123131],
    [35.73768032, 31.64296822],
    [35.95122826, 31.54213801],
    [36.16355218, 31.43875516],
    [36.37462155, 31.33283453],
    [36.58440604, 31.22439135],
    [36.79287551, 31.11344119],
    [37., 31.],
    [38.11, 30.32],
    [38.89, 29.6],
    [40.3, 29.56],
    [136.89, 29.56],
    [136.89, 29.56],
    [137.66713566, 29.59021815],
    [138.42646987, 29.75833873],
    [139.1437307, 30.05898781],
    [139.79599108, 30.48255523],
    [140.36240169, 31.01550175],
    [140.82485734, 31.64079188],
    [141.16857576, 32.33843836],
    [141.38257007, 33.08614111],
    [141.46, 33.86],
    [141.46, 35.86],
    [141.46, 37.93],
    [141.46, 49.51],
    [141.46, 61.09],
    [141.46, 77.2],
    [141.46, 93.3],
    [141.46, 107.3],
    [141.46, 121.3],
    [141.46, 129.8],
    [141.46, 131.53],
    [141.71, 133.48],
    [140.58, 134.93],
    [139.45, 136.38],
    [137.06, 137.08],
    [135.34, 137.93],
    [135.34, 137.93],
    [134.42, 140.1],
    [131.96, 140.09],
    [130., 140.09],
    [40.15, 140.09],
    [38.32, 140.09],
    [36.49, 140.09],
    [34.66, 140.09],
    [34.66, 140.09],
    [34.32771717, 140.08714929],
    [33.99633797, 140.06249516],
    [33.66729152, 140.01614394],
    [33.34199689, 139.94829552],
    [33.02185697, 139.85924251],
    [32.70825243, 139.74936898],
    [32.40253573, 139.61914876],
    [32.10602534, 139.46914346],
    [31.82, 139.3],
    [29.49, 137.69],
    [30.04, 135.],
    [30.19, 132.6],
    [30.36, 130.06],
    [30.36, 130.06],
    [29.80583632, 129.79909092],
    [29.2929578, 129.46423787],
    [28.8311692, 129.06184226],
    [28.42929857, 128.59959673],
    [28.09502849, 128.08633807],
    [27.83474925, 127.53187829],
    [27.65343662, 126.94681704],
    [27.55455677, 126.34233899],
    [27.54, 125.73],
    [27.54, 38.23]])

NIRISS_GR700XD_MASK_VERTS.flags.writeable = False
NIRISS_GR700XD_MASK_CODES = (
    Path.MOVETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.CURVE3,
    Path.LINETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.CURVE4,
    Path.CURVE4,
    Path.CURVE4,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
)

NIRISS_GR700XD_MASK_PATH = Path(NIRISS_GR700XD_MASK_VERTS, NIRISS_GR700XD_MASK_CODES)

#
# NIRISS GR700XD grism mask dimensions
#
# Provenance:
#
# COM DEV drawing #206726
# "GR700 (ZNSE) MASK RETAINER, ROTATED 270 DEG LLNL"
# provided by Loic Albert (UdeM) 2016-11-04

NIRISS_GR700XD_MASK_WIDTH, NIRISS_GR700XD_MASK_HEIGHT = 26.8 * u.mm, 26.0 * u.mm
